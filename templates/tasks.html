{% extends "base.html" %}
{% block content %}

<style>
  .badge {
    padding: 0.25em 0.6em;
    border-radius: 0.4em;
    font-size: 0.85em;
    font-weight: 600;
    color: white;
    margin-left: 0.5em;
    text-transform: capitalize;
  }
  .badge.pending { background-color: #f0ad4e; }
  .badge.in_progress { background-color: #5bc0de; }
  .badge.done { background-color: #5cb85c; }

  table.task-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1.5em;
  }
  table.task-table th, table.task-table td {
    border: 1px solid #ccc;
    padding: 0.6em;
    text-align: left;
  }
  table.task-table th {
    background-color: #f9f9f9;
  }
</style>

<h1>üìã SmartCoach Task Dashboard</h1>
<form method="get">
  <label for="status">Status</label>
  <select name="status" id="status">
    <option value="">All</option>
    <option value="pending" {% if filters.status == 'pending' %}selected{% endif %}>Pending</option>
    <option value="in_progress" {% if filters.status == 'in_progress' %}selected{% endif %}>In Progress</option>
    <option value="done" {% if filters.status == 'done' %}selected{% endif %}>Done</option>
  </select>

  <label for="milestone">Milestone</label>
  <input type="text" name="milestone" id="milestone" value="{{ filters.milestone or '' }}">

  <label for="label">Label</label>
  <input type="text" name="label" id="label" value="{{ filters.label or '' }}">

  <label for="icebox">Icebox</label>
  <select name="icebox" id="icebox">
    <option value="">Any</option>
    <option value="true" {% if filters.icebox == 'true' %}selected{% endif %}>Yes</option>
    <option value="false" {% if filters.icebox == 'false' %}selected{% endif %}>No</option>
  </select>

  <label for="sort">Sort By</label>
  <select name="sort" id="sort">
    <option value="">None</option>
    <option value="status" {% if filters.sort == 'status' %}selected{% endif %}>Status</option>
    <option value="milestone" {% if filters.sort == 'milestone' %}selected{% endif %}>Milestone</option>
  </select>

  <button type="submit">Filter</button>
</form>

{% if tasks %}
<table class="task-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Title</th>
      <th>Details</th>
      <th>Milestone</th>
      <th>Labels</th>
      <th>Status</th>
      <th>Icebox</th>
    </tr>
  </thead>
  <tbody>
    {% for task in tasks %}
    <tr>
      <td>{{ task.id }}</td>
      <td>{{ task.title }}</td>
      <td>{{ task.details or '‚Äî' }}</td>
      <td>{{ task.milestone or '‚Äî' }}</td>
      <td>
        {% if task.labels %}
          {{ task.labels | join(', ') }}
        {% else %}
          ‚Äî
        {% endif %}
      </td>
      <td><span class="badge {{ task.status }}">{{ task.status }}</span></td>
      <td>{{ '‚úÖ' if task.is_icebox else '‚ùå' }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
  <p>No tasks found matching your filters.</p>
{% endif %}

{% endblock %}
